datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// تعریفِ enumِ جدید برای نوع لاگ
enum LogType {
  PAGE_VIEW    // زمانی که کاربر صفحه‌ای را باز می‌کند
  API_REQUEST  // زمانی که یک Axios (یا هر) درخواست API زده می‌شود
}

model UserLog {
  id           Int   @id @default(autoincrement())
  username     String
  type         LogType
  url          String
  method       String?
  status       Int?
  params       Json?
  responseData Json?      // ← اضافه شد
  user_agent   String
  ip           String
  timestamp    DateTime @default(now())
  device       String?
  os           String?
  browser      String?
  location     Json?
}

enum ErrorType {
  NAVIGATION           // خطای Router (مثلاً 404)
  COMPONENT            // خطاهای Vue component
  UNHANDLED_REJECTION  // Promise rejection مدیریت‌نشده
  API_ERROR            // خطای axios/useFetch
}

model ErrorLog {
  id            Int     @id @default(autoincrement())
  username      String
  type          ErrorType
  url           String
  lastRoute     String?    // مسیر قبلی
  user_agent    String
  ip            String?    // اختیاری
  timestamp     DateTime   @default(now())
  device        String?
  os            String?
  browser       String?
  location      Json?

  // جزئیات همهٔ خطا (errorMessage، stack، vueInfo، formData، performance و غیره)
  details       Json?

  // اسکرین‌شات صفحه در لحظهٔ خطا (Base64)
  screenshot    String?
}

model Permission {
  id    Int  @id @default(autoincrement())
  key   String  @unique // مثلا users.view
  module String // مثلا users
  action String // مثلا view
  roles Role[]  // رابطه many-to-many با نقش‌ها

  @@index([key])
}

model Role {
  id          Int       @id @default(autoincrement())
  name        String       @unique
  permissions Permission[] // رابطه many-to-many با دسترسی‌ها
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([name])
}
